<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mover todos los archivos del mismo tipo de un arbol de directorios a la vez</title>
  <meta name="author" content="joe di castro" />
  <meta name="keywords" content="python, script, mover, copiar, borrar, linux, windows">
  <link rel="author" href="./humans.txt" />
  <link href='http://fonts.googleapis.com/css?family=Vollkorn:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
  <link href="./atom.xml" type="application/atom+xml" rel="alternate" title="joe di castro ATOM Feed" />
  <link href="./rss.xml" type="application/atom+xml" rel="alternate" title="joe di castro RSS Feed" />
  
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body id="index" class="home">

  <header id="banner" class="body">
    <h1><a href="."><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAxBAMAAADKNk2HAAAAAXNSR0IArs4c6QAAABhQTFRFvI0Ww5kxzaxW2Lp049Ki7ePG8+zX/f/8R8l4ugAAAAFiS0dEAIgFHUgAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfbDAsTFi548ol9AAADmElEQVRIx62XTXOjOBCGJeHMuWWwueLZyXAV8aS4hpnscg07yXJdnCpz5kv6+9stk4CzMJusocoOBvTQ3Xr7lcLMcLQ3ch2b/3+w17MuAi6BxwuwWuC3pXmGzeWsBlz7t+AXs9qXeOo5ls7fywq8l/jYzBgVvpNV8PKF9Xp2fnRyFpHkY1YHry+dy7GanZOWn8WViWHMDCuY1UqxHbP0EJapxHSK89Mr0zFrHMvd5oMp1uJ4LAdW5gy3wH9nis1OSsmGozyx1NWQC6S/ru8Qz+ff9vv7+0f51/H49PT0ex9XsPqv0g/1/Vfy3rm+Mv7tW/8zW02OmI72bfLM9iITvyxXI8ykgh9R2m91396WL205GUDi11PxFsJkvtET/jVfLi3TyW6ErZF5K2dYaiSjcqzf7ly596d2y2vHJM4Mixqgdb8j5k/o39fdhMFrEXXEU7rHqOK7rVG+PlX4cP3lDYsauwPGfBNxcHqP5HuZP/dWEAjkHrhHZS1YiuZR8TIhp2IsPWdljv6Ocxr4GY+jlLJswcMsNOT9fdRyC1+1SyYkSVyZG6EGgHuy7M5Y4GJXQAh7RqUuPmEBPcT51ar3tjzz6FKNjXLncfLHADCLgvEDb8SYhZG6as1rrlY6xdnLbdKKlyjIh9Ba6y6/Q7PEsjaidjDFRnyWpWZylXkQj1hY2OtWVkJxJuUn84B9o3xTM6cVtiEbYd/n0/qiIa62GK6K8etvEWyAbcbr444e21YM5COsS1I0hqYxh8K3bk8fDbzscOqUYwJfhY2DNM3CgHN3NI8d4GMmSDvmIic3EJM3mWQty4B0hGB8KmJXOMd5wX56cCtzFWPAD9xU7HqkLx2sUXX4fIEcnHjridXqwBOvFba1qOAZV2HGeM18teMF2wtTbRvCu2OtRqLE0DueUF05tZptKQiVXzvWwytUFmzVDU8YqgLAU0LhnLgQeTuej1gZz+1qhkLBUVfPJxNv5AZLRhqzThXhieJhxTysiMzlD4cGbhrWb0JOrEbGJqMRbXoKp/e+I3YUfVsPYfSeLrWXqEFLRQiM6LEc9yPtAIbFqJXXU3bx8483F75Mrdu0bFcXbEpGLLtsq+0iLFrTWpkuwbJhFcIswbKYmTX2oyzC1DNbpQ+yLEZtzBKsxFum8sSiyo93JxewrE9BuAiLvHwBzVsW2vAigiBWEC4VlmEQ64XCQtYmWigszJFd8q/ZOesgvy6EMv8ALXTFAI7iFV4AAAAASUVORK5CYII=" alt="Sobre mí" title="Sobre mí" width="150" height="49" /> </a></h1>
      <nav>
      	<ul>
         
         <li class="active"><a href="./category/blog.html">blog</a></li>
         <li><a href="./archives.html">archivo</a></li>
         <li><a href="./tags.html">etiquetas</a></li>
         
         <li><a href="./pages/code.html">code</a></li><li><a href="./pages/markdown.html">markdown</a></li>
         
         <li><a href="./rss.xml">rss</a></li>
       </ul>
     </nav>
  </header><!-- /#banner -->        
<section id="content" class="body">    
<article>
  <header> 
  	<h1 class="entry-title">
      <a href="mover-todos-los-archivos-del-mismo-tipo-de-un-arbol-de-directorios-a-la-vez.html" rel="bookmark" title="Permalink a Mover todos los archivos del mismo tipo de un arbol de directorios a la vez">Mover todos los archivos del mismo tipo de un arbol de directorios a la vez</a>
  	</h1>
  	
  </header>
  <div class="entry-content">
    <abbr class="published" title="2011-04-26T23:17:00">
      Públicado el mar 26 abril 2011
    </abbr>
    <p>A veces tenemos la necesidad de <strong>mover (o copiar o borrar)</strong> varios ficheros 
del mismo tipo a la vez, pero estos no "cuelgan" de un solo directorio, si no 
que se encuentran repartidos dentro una jerarquía de subdirectorios. En este 
caso los típicos comandos para mover/copiar/borrar archivos no nos sirven, ni 
siquiera los útiles comodines nos resuelven el problema.  ¿Como lo hacemos 
entonces?</p>
<p>Por ejemplo, si tenemos una estructura de directorios como esta:</p>
<div class="codehilite"><pre>raiz
├── dir_1
│   ├── imagen_1.jpg
│   ├── pdf_1.pdf
│   ├── texto_1.txt
│   └── texto_2.txt
├── dir_2
│   ├── imagen_2.jpg
│   ├── imagen_3.gif
│   └── texto_3.txt
├── dir_3
│   ├── doc_1.doc
│   ├── pdf_2.pdf
│   ├── pdf_3.pdf
│   ├── pdf_4.pdf
│   ├── texto_4.txt
│   └── texto_5.txt
├── dir_4
│   ├── subdir_1
│   │   └── imagen_4.png
│   ├── subdir_2
│   │   ├── pdf_5.pdf
│   │   └── texto_7.txt
│   ├── doc_2.doc
│   └── texto_6.txt
└── dir_5
</pre></div>


<p>Y queremos mover todos los ficheros <code>.txt</code> al <code>dir_5</code> que tenemos vacío, ¿Como 
lo hacemos? Bueno, en el caso de <strong>Linux</strong> (y UNIX) podemos hacerlo en una sola 
operación gracias al siempre útil y versátil <code>find</code> con el siguiente comando 
(ejecutado desde el directorio raíz):</p>
<div class="codehilite"><pre>find . -type f -name *.txt -exec mv <span class="o">{}</span> ./dir_5 <span class="se">\;</span>
</pre></div>


<p>Este comando nos encontraría todos los archivos con la extensión <code>.txt</code> dentro 
de todos los directorios y subdirectorios y los iría moviendo uno a uno al 
<code>dir_5</code>. Es un comando rápido y efectivo. Genéricamente, el comando sería así:</p>
<div class="codehilite"><pre>find directorio_origen -type f -name *.EXT -exec mv <span class="o">{}</span> ./directorio_destino <span class="se">\;</span>
</pre></div>


<p>donde <code>EXT</code> sería la extensión del tipo de archivo que queremos mover. Se puede 
emplear esta variante para copiar los archivos en vez de moverlos:</p>
<div class="codehilite"><pre>find directorio_origen -type f -name *.EXT -exec cp <span class="o">{}</span> ./directorio_destino <span class="se">\;</span>
</pre></div>


<p>Y esta otra para eliminarlos (¡emplear con cuidado!):</p>
<div class="codehilite"><pre>find directorio_origen -type f -name *.EXT -exec rm -f <span class="o">{}</span> <span class="se">\;</span>
</pre></div>


<p>Partiendo de la idea de hacer algo equivalente en <strong>Python</strong>, he creado un 
script que hace algo similar a esto, sin la necesidad de teclear todo el comando 
(y con el riesgo a equivocarse y liarla parda) y que también sirve para que los 
no trabajen habitualmente con la consola no necesiten recordar (o anotar) esos 
comandos.</p>
<p>La parte principal del script <strong>move_by_ext.py</strong> es la siguiente:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">find_and_process</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the files by file extension and process (move/copy/remove) them.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">the_path</span><span class="p">,</span> <span class="n">the_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process each file.&quot;&quot;&quot;</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">src_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">the_path</span><span class="p">,</span> <span class="n">the_file</span><span class="p">)</span>
        <span class="n">dst_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dst</span><span class="p">,</span> <span class="n">the_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">rm</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">src_file</span><span class="p">)</span>
            <span class="n">processed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst_file</span><span class="p">):</span> <span class="c"># not replace if already exists </span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cp</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src_file</span><span class="p">,</span> <span class="n">dst_file</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src_file</span><span class="p">,</span> <span class="n">dst_file</span><span class="p">)</span>
                <span class="n">processed</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">processed</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dst</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dst</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">directories</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">src</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fil</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="c"># ignore files without extension (can have the same name as the ext)</span>
            <span class="n">file_ext</span> <span class="o">=</span> <span class="n">fil</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fil</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="c"># ignore dots in given extensions</span>
            <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">ext</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">file_ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="n">process</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fil</span><span class="p">)</span>

    <span class="n">opt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&quot;{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">rm</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">cp</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="s">&quot;Files {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="s">&quot;moved&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s">&quot;copied&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s">&quot;removed&quot;</span><span class="p">}[</span><span class="n">opt</span><span class="p">],</span> <span class="n">count</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log</span>
</pre></div>


<p>Este script nos permite realizar las mismas operaciones que los comandos 
anteriores y además tiene dos ventajas adicionales:</p>
<ul>
<li>
<p><strong>Permite emplear varias extensiones a la vez</strong>, lo que nos permite
mover/copiar/borrar distintos tipos de archivo en una sola operación.
Por ejemplo si queremos mover todos los tipos de imagen de la estructura de 
directorios anterior, podríamos hacerlo indicándole que emplee las extensiones 
<code>.jpg</code>, <code>.gif</code> y <code>.png</code> en la misma operación. El comando sería el siguiente 
(las extensiones pueden llevar o no el punto, funciona exactamente igual), 
ejecutado desde el directorio raíz:</p>
<p><code>python move_by_ext.py jpg .gif png -d ./dir_5</code></p>
</li>
<li>
<p><strong>Funciona en Windows</strong>. A diferencia del comando para Linux, este se puede 
emplear en Windows sin necesidad de instalar ningún entorno que nos simule un 
shell Linux (como <a href="http://www.cygwin.com/">Cygwin</a>) y solo es necesario tener 
instalado Python 2.7</p>
</li>
</ul>
<p>La sintaxis del script es muy sencilla y se puede ver reflejada en la ayuda del 
mismo:</p>
<div class="codehilite"><pre><span class="gp">$</span> python move_by_ext.py -h
<span class="go">usage: move_by_ext.py ext [-s SRC] [-d DST] [-c | -r] [--help]</span>

<span class="go">Move (or copy/remove) all files selected by extension into a directory tree to</span>
<span class="go">a destination directory.</span>

<span class="go">positional arguments:</span>
<span class="go">  ext                the extension(s) of the files to process. To use more</span>
<span class="go">                     than one extension, separate them with a space</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help         show this help message and exit</span>
<span class="go">  -s SRC, --src SRC  the source path. Current dir if none is provided</span>
<span class="go">  -d DST, --dst DST  the destination path. Current dir if none is provided</span>
<span class="go">  -c, --copy         copy all the files with the given extension(s) to the</span>
<span class="go">                     destination directory.</span>
<span class="go">  -r, --remove       remove all the files with the given extension(s). Use</span>
<span class="go">                     with caution! remove also in the subdirectories</span>
<span class="go">  -v, --version      show program&#39;s version number and exit</span>
</pre></div>


<p>El script completo puede encontrarse en el repositorio <em>Python Recipes</em> alojado
en <a href="http://github.com/joedicastro/python-recipes">github</a>.</p>
  </div><!-- /.entry-content -->
  <p class="tagged">Etiquetado como: <a href="./tag/python.html">python</a>, <a href="./tag/script.html">script</a>, <a href="./tag/mover.html">mover</a>, <a href="./tag/copiar.html">copiar</a>, <a href="./tag/borrar.html">borrar</a>, <a href="./tag/linux.html">linux</a>, <a href="./tag/windows.html">windows</a>.</p>

  
  <div class="comments">
    <h3>Comentarios !</h3>
    <div id="disqus_thread"></div>
      <script type="text/javascript">
         var disqus_identifier = "mover-todos-los-archivos-del-mismo-tipo-de-un-arbol-de-directorios-a-la-vez.html";
         (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = 'http://joedicastro.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>
  
</article>
</section>
<footer id="contentinfo" class="body">
    <address id="about" class="vcard body">
      © 2010-2015 joe di castro - <a
          href="mailto:joe@joedicastro.com">correo</a>|<a
          href="http://twitter.com/joe_di_castro">twitter</a>|<a
          href="https://github.com/joedicastro">github</a> <span id="license">El contenido está bajo <a href="http://creativecommons.org/licenses/by-sa/3.0/es">licencia Creative Commons</a></span>
    </address><!-- /#about -->
  </footer><!-- /#contentinfo -->


<script type="text/javascript">
    var disqus_shortname = 'joedicastro';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</body>
</html>