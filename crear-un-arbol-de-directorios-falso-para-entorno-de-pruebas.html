<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Crear un arbol de directorios falso para entorno de pruebas</title>
  <meta name="author" content="joe di castro" />
  <meta name="keywords" content="script, python, lorem ipsum">
  <link rel="author" href="./humans.txt" />
  <link href='http://fonts.googleapis.com/css?family=Vollkorn:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
  <link href="./atom.xml" type="application/atom+xml" rel="alternate" title="joe di castro ATOM Feed" />
  <link href="./rss.xml" type="application/atom+xml" rel="alternate" title="joe di castro RSS Feed" />
  
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body id="index" class="home">

  <header id="banner" class="body">
    <h1><a href="."><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAxBAMAAADKNk2HAAAAAXNSR0IArs4c6QAAABhQTFRFvI0Ww5kxzaxW2Lp049Ki7ePG8+zX/f/8R8l4ugAAAAFiS0dEAIgFHUgAAAAJcEhZcwAADdcAAA3XAUIom3gAAAAHdElNRQfbDAsTFi548ol9AAADmElEQVRIx62XTXOjOBCGJeHMuWWwueLZyXAV8aS4hpnscg07yXJdnCpz5kv6+9stk4CzMJusocoOBvTQ3Xr7lcLMcLQ3ch2b/3+w17MuAi6BxwuwWuC3pXmGzeWsBlz7t+AXs9qXeOo5ls7fywq8l/jYzBgVvpNV8PKF9Xp2fnRyFpHkY1YHry+dy7GanZOWn8WViWHMDCuY1UqxHbP0EJapxHSK89Mr0zFrHMvd5oMp1uJ4LAdW5gy3wH9nis1OSsmGozyx1NWQC6S/ru8Qz+ff9vv7+0f51/H49PT0ex9XsPqv0g/1/Vfy3rm+Mv7tW/8zW02OmI72bfLM9iITvyxXI8ykgh9R2m91396WL205GUDi11PxFsJkvtET/jVfLi3TyW6ErZF5K2dYaiSjcqzf7ly596d2y2vHJM4Mixqgdb8j5k/o39fdhMFrEXXEU7rHqOK7rVG+PlX4cP3lDYsauwPGfBNxcHqP5HuZP/dWEAjkHrhHZS1YiuZR8TIhp2IsPWdljv6Ocxr4GY+jlLJswcMsNOT9fdRyC1+1SyYkSVyZG6EGgHuy7M5Y4GJXQAh7RqUuPmEBPcT51ar3tjzz6FKNjXLncfLHADCLgvEDb8SYhZG6as1rrlY6xdnLbdKKlyjIh9Ba6y6/Q7PEsjaidjDFRnyWpWZylXkQj1hY2OtWVkJxJuUn84B9o3xTM6cVtiEbYd/n0/qiIa62GK6K8etvEWyAbcbr444e21YM5COsS1I0hqYxh8K3bk8fDbzscOqUYwJfhY2DNM3CgHN3NI8d4GMmSDvmIic3EJM3mWQty4B0hGB8KmJXOMd5wX56cCtzFWPAD9xU7HqkLx2sUXX4fIEcnHjridXqwBOvFba1qOAZV2HGeM18teMF2wtTbRvCu2OtRqLE0DueUF05tZptKQiVXzvWwytUFmzVDU8YqgLAU0LhnLgQeTuej1gZz+1qhkLBUVfPJxNv5AZLRhqzThXhieJhxTysiMzlD4cGbhrWb0JOrEbGJqMRbXoKp/e+I3YUfVsPYfSeLrWXqEFLRQiM6LEc9yPtAIbFqJXXU3bx8483F75Mrdu0bFcXbEpGLLtsq+0iLFrTWpkuwbJhFcIswbKYmTX2oyzC1DNbpQ+yLEZtzBKsxFum8sSiyo93JxewrE9BuAiLvHwBzVsW2vAigiBWEC4VlmEQ64XCQtYmWigszJFd8q/ZOesgvy6EMv8ALXTFAI7iFV4AAAAASUVORK5CYII=" alt="Sobre mí" title="Sobre mí" width="150" height="49" /> </a></h1>
      <nav>
      	<ul>
         
         <li class="active"><a href="./category/blog.html">blog</a></li>
         <li><a href="./archives.html">archivo</a></li>
         <li><a href="./tags.html">etiquetas</a></li>
         
         <li><a href="./pages/markdown.html">markdown</a></li>
         
         <li><a href="https://github.com/joedicastro/joedicastro.github.io/issues/new">feedback</a></li>
         <li><a href="./rss.xml">rss</a></li>
       </ul>
     </nav>
  </header><!-- /#banner -->        
<section id="content" class="body">    
<article>
  <header> 
  	<h1 class="entry-title">
      <a href="crear-un-arbol-de-directorios-falso-para-entorno-de-pruebas.html" rel="bookmark" title="Permalink a Crear un arbol de directorios falso para entorno de pruebas">Crear un arbol de directorios falso para entorno de pruebas</a>
  	</h1>
  	
  </header>
  <div class="entry-content">
    <abbr class="published" title="2011-04-27T20:52:00">
      Públicado el mié 27 abril 2011
    </abbr>
    <p>A veces, para realizar pruebas con nuestros propios programas o para, por 
ejemplo, hacer pruebas con programas de Backup o FTP, necesitamos crear un 
entorno de pruebas que nos permita hacer todo tipo de operaciones sin comprometer 
la seguridad de nuestros datos reales. Una practica habitual es hacer copias de 
directorios de nuestros propios archivos y trabajar sobre ellos. Es algo que 
creo se debería dejar únicamente para la última fase de las pruebas, cuando en 
teoría ya todo funciona. Confundir ubicaciones y malograr los datos reales es 
más fácil de lo que pueda parecer, sobre todo si se comparte el mismo sistema de 
archivos. Otra veces lo que necesitamos es generar una estructura de directorios 
totalmente aleatoria, con sus correspondientes archivos de forma temporal. </p>
<p>He creado un script <strong>Python</strong> que hace precisamente esto último, generar una 
jerarquía completa de directorios, de forma aleatoria, con sus correspondientes 
archivos de texto para simular una estructura de directorios real. Cuando le 
estaba dando vueltas a como generar de forma aleatoria los nombres de los 
archivos y que al mismo tiempo fuera multiplataforma (respetando los caracteres 
no permitidos según el sistema de archivos) me acorde de <a href="http://es.wikipedia.org/wiki/Lorem_ipsum">Lorem Ipsum</a>. El 
texto que se lleva empleando desde los tiempos de la imprenta para generar 
borradores y que aún se emplea en diseño gráfico para los contenidos de prueba 
(al igual que en la web). No solo hacía de este modo un guiño a esta veterana 
prueba de maquetación, si no que me solucionaba la papeleta de generar los 
nombres de directorios y archivos. Al estar compuesto de "palabras" en latín 
(solo caracteres del alfabeto) me olvidaba de las incompatibilidades entre 
plataformas y sistemas de archivo. Un homenaje y un problema resuelto en un solo 
paso.</p>
<p>Cuando me disponía ya a crear un modo de extraer palabras aleatorias del texto 
original de Lorem Ipsum, pensé que seguro que no era el primero al que se le 
ocurría hacer esto con Python, así que después de una pequeña búsqueda en el 
<a href="http://pypi.python.org/pypi"><abbr title="Python Package Index"><abbr title="Python Package Index">PyPI</abbr></abbr></a>, di con el magnifico proyecto de James Hales, 
<a href="http://code.google.com/p/lorem-ipsum-generator/">Lorem-Ipsum-Generator</a>. Importando el modulo de este proyecto en mi script, 
tenía medio trabajo hecho.</p>
<p>El script, al que llamo <strong>test_dir_tree</strong>, genera una estructura de directorios 
de entre 7 y 39 directorios (estos parámetros pueden ser fácilmente cambiados en 
el script), con sus correspondientes archivos. El número de archivos se decide 
en función del número de directorios y se reparten también de forma aleatoria 
entre los mismos. Como he comentado, los nombres tanto de directorios como 
ficheros proceden de Lorem Ipsum. El tamaño de los archivos oscila entre 3 y 512 
Kbytes, para no ocupar demasiado espacio en disco. Son archivos de texto 
normales en los cuales el contenido está formado a su vez por párrafos 
aleatorios de Lorem Ipsum.</p>
<p>No es necesario ningún parámetro para ejecutar el script:</p>
<div class="codehilite"><pre><span class="go">python test_dir_tree.py</span>
</pre></div>


<p>Una vez ejecutado el script, se genera una estructura de directorios como la de 
este ejemplo:</p>
<div class="codehilite"><pre>test
├── blandit
│   ├── [234K]  bibendum.txt
│   ├── [319K]  congue.txt
│   ├── [382K]  consequat.txt
│   └── [298K]  ligula.txt
├── elit
├── est
│   ├── [ 22K]  condimentum.txt
│   ├── [401K]  hac.txt
│   ├── [139K]  nibh.txt
│   └── [ 12K]  tincidunt.txt
├── habitasse
│   ├── [359K]  etiam.txt
│   ├── [ 59K]  facilisi.txt
│   ├── [ 12K]  integer.txt
│   ├── [ 23K]  metus.txt
│   └── [ 31K]  non.txt
├── lacus
│   ├── [394K]  faucibus.txt
│   └── [ 29K]  torquent.txt
├── laoreet
│   └── [424K]  eros.txt
├── litora
│   └── [ 87K]  tellus.txt
└── nostra
    ├── [349K]  curabitur.txt
    ├── [241K]  neque.txt
    ├── [3.4K]  odio.txt
    └── [ 78K]  sapien.txt
</pre></div>


<p>Donde el principio del contenido de uno de esos archivos de texto, sería algo así:</p>
<div class="codehilite"><pre>Eget. Sem turpis tempus sagittis arcu, nullam ac rutrum turpis. Sem
fusce lacus, cum neque fermentum potenti. Est aliquam donec, leo
amet elit dapibus ipsum. Quam pellentesque eu fusce pellentesque
torquent netus vivamus velit at nisl. Senectus ligula, erat dictum.
Natoque metus urna quis vivamus in duis. Cras. Massa nam. Quisque.
Potenti, sit. Urna metus, et eu duis suspendisse per primis. Duis,
viverra massa enim hac.

Fames ut leo in a turpis proin gravida ac, auctor. Natoque
suspendisse nisl. Dictumst mus, amet pede, eni velit velit. Elit.
Cum. Congue pretium ad id porta in massa enim purus. Tempus, porta
donec molestie habitasse, urna urna nam. Tempor massa sed quam sit
nec dapibus at, duis. Leo pellentesque. Orci arcu iaculis ac, elit
netus conubia. Penatibus platea rutrum netus suspendisse non. Purus
consequat. Inceptos platea, tempus metus eu consectetuer feugiat,
urna at lorem pellentesque curae. Dapibus a, scelerisque cum, auctor
 tincidunt primis. Augue nisi id per nulla, sit enim mus id eleifend
 taciti, semper est.
</pre></div>


<p>El script tarda muy poco en generar esta estructura, por ejemplo en un Core 2 
Duo a 2 GHz, se tardan 1.72s en generar una estructura de 71 directorios y 114 
ficheros.</p>
<p>Este es el núcleo central del script <strong>test_dir_tree.py</strong>:</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">test_tree</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">min_dirs</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">max_dirs</span><span class="o">=</span><span class="mi">79</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;make a fake directory hierarchy with files for test purposes.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">latin_words</span><span class="p">(</span><span class="n">generator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a list of latin words&quot;&quot;&quot;</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate_paragraphs_plain</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">check_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If no exists a path, make it.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">lorem</span> <span class="o">=</span> <span class="n">lipsum</span><span class="o">.</span><span class="n">MarkupGenerator</span><span class="p">()</span>
    <span class="n">latins</span> <span class="o">=</span> <span class="n">latin_words</span><span class="p">(</span><span class="n">lorem</span><span class="p">)</span>

    <span class="n">dirs</span> <span class="o">=</span> <span class="n">latins</span><span class="p">[:</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_dirs</span><span class="p">,</span> <span class="n">max_dirs</span><span class="p">)]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">latins</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">][:</span><span class="nb">len</span><span class="p">((</span><span class="n">dirs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span>

    <span class="n">check_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
        <span class="n">check_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">directory</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">fil</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">choice</span><span class="p">(</span><span class="n">dirs</span><span class="p">),</span> <span class="s">&#39;{0}.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fil</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">524288</span><span class="p">)</span> <span class="c"># Files not bigger than 512 Kbytes</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">lorem</span><span class="o">.</span><span class="n">generate_paragraphs_plain</span><span class="p">(</span><span class="n">randrange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="n">sample</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="n">size</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span>
</pre></div>


<p>Para obtener el script completo, acudir a mi repositorio <em>Python Recipes</em> que
está alojado en <a href="http://github.com/joedicastro/python-recipes">github</a>.</p>
  </div><!-- /.entry-content -->
  <p class="tagged">Etiquetado como: <a href="./tag/script.html">script</a>, <a href="./tag/python.html">python</a>, <a href="./tag/lorem%20ipsum.html">lorem ipsum</a>.</p>

  
</article>
</section>
<footer id="contentinfo" class="body">
    <address id="about" class="vcard body">
      © 2010-2015 joe di castro - <a
          href="mailto:joe@joedicastro.com">correo</a>|<a
          href="http://twitter.com/joe_di_castro">twitter</a>|<a
          href="https://github.com/joedicastro">github</a> <span id="license">El contenido está bajo <a href="http://creativecommons.org/licenses/by-sa/3.0/es">licencia Creative Commons</a></span>
    </address><!-- /#about -->
  </footer><!-- /#contentinfo -->


</body>
</html>